@page
@model SharingMezzi.Web.Pages.LoginModel
@{
    ViewData["Title"] = "Login";
    ViewData["BodyClass"] = "auth-page";
    Layout = "_AuthLayout";
}

<div class="auth-card premium-card animate-fade-in-up" style="max-width: 420px; margin: 4rem auto;">
    <div class="auth-header text-center mb-4">
        <div class="auth-logo mb-3">
            <i class="fas fa-bicycle bg-primary" style="font-size:2.5rem; border-radius:50%; padding:0.7rem;"></i>
        </div>
        <h1 class="page-title mb-2">Benvenuto</h1>
        <p class="page-subtitle">Accedi al tuo account SharingMezzi</p>
    </div>

    <form class="auth-form" method="post">
        @Html.AntiForgeryToken()
        
        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger mb-3" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i> @Model.ErrorMessage
            </div>
        }
        
        <div class="form-group">
            <label for="Email" class="form-label">Email</label>
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fas fa-envelope"></i>
                </span>
                <input type="email" class="form-control" id="Email" name="LoginRequest.Email" 
                       placeholder="Inserisci la tua email" required>
            </div>
        </div>

        <div class="form-group">
            <label for="Password" class="form-label">Password</label>
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fas fa-lock"></i>
                </span>
                <input type="password" class="form-control" id="Password" name="LoginRequest.Password" 
                       placeholder="Inserisci la tua password" required>
            </div>
        </div>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="remember" name="remember">
            <label class="form-check-label" for="remember">
                Ricordami
            </label>
        </div>

        <button type="submit" class="btn-premium btn-auth w-100 mt-3" id="loginButton">
            <i class="fas fa-sign-in-alt"></i> Accedi
        </button>
        
        <!-- Loading spinner rimosso per usare form server-side -->
    </form>

    <div class="auth-links text-center mt-4">
        <p>
            <a href="/ForgotPassword" class="btn-premium-ghost btn-sm">
                <i class="fas fa-key"></i> Password dimenticata?
            </a>
        </p>
        <p>
            Non hai un account?
            <a href="/Register" class="btn-premium-ghost btn-sm ms-2">
                <i class="fas fa-user-plus"></i> Registrati
            </a>
        </p>
    </div>

    <!-- Social Login temporaneamente disabilitato per usare ASP.NET Core form -->
    <!-- 
    <div class="social-login">
        <div class="social-login-title">
            <span>Oppure accedi con</span>
        </div>
        <div class="social-buttons">
            <button type="button" class="btn-social btn-google" onclick="authManager.loginWithGoogle()">
                <i class="fab fa-google"></i>
                Accedi con Google
            </button>
            <button type="button" class="btn-social btn-facebook" onclick="authManager.loginWithFacebook()">
                <i class="fab fa-facebook-f"></i>
                Accedi con Facebook
            </button>
        </div>
    </div>
    -->
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on email field
            document.getElementById('Email').focus();
            
            // Debug form submission
            const form = document.querySelector('.auth-form');
            const button = document.getElementById('loginButton');
            
            console.log('Login form found:', form);
            console.log('Login button found:', button);
            
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log('=== FORM SUBMIT EVENT ===');
                    console.log('Form action:', form.action);
                    console.log('Form method:', form.method);
                    
                    const emailInput = document.getElementById('Email');
                    const passwordInput = document.getElementById('Password');
                    
                    console.log('Email value:', emailInput?.value);
                    console.log('Password length:', passwordInput?.value?.length || 0);
                    
                    // Don't prevent default - let the form submit normally
                    console.log('Allowing form to submit...');
                });
            }
            
            if (button) {
                button.addEventListener('click', function(e) {
                    console.log('=== BUTTON CLICK EVENT ===');
                    console.log('Button clicked, form should submit');
                });
            }
        });
    </script>
}
